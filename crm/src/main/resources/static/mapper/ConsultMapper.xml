<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.studentcrm.crm.mapper.AttendanceMapper">
<insert id="insertConsult" parameterType="org.studentcrm.crm.command.ConsultVO" useGeneratedKeys="true" keyProperty="consult_id">>
	insert into consult (consult_id, consult_date, t_id, s_id, consult_content)
	values(#{consult_id}, #{consult_date}, #{t_id}, #{s_id}, #{consult_content)
</insert>

<select id="showConsultByT_id" parameterType="java.lang.Integer" resultType="org.studentcrm.crm.command.ConsultVO" >
	select * from consult where t_id = #{t_id} order by num desc limit 10
</select>

<select id="showConsultByDateAndS_id" parameterType="java.lang.Integer" resultType="org.studentcrm.crm.command.ConsultVO" >
	select * from consult where s_id = #{s_id} order by num desc limit 10
</select>

<update id="updateConsult" parameterType="org.studentcrm.crm.command.ConsultVO">
	update consult set consult_date=#{consult_date}, s_id=#{s_id}, consult_content=#{consuld_content}
</update>

<delete id="deleteConsult" parameterType="java.lang.Integer">
	delete from consult where consult_id = #{consult_id}
</delete>

<!-- 게시물 총 수 -->
<select id="getTotal" parameterType="java.lang.Integer" resultType="int">
	select count(*) from consult where t_id=#{t_id}
</select>
	
<!-- 페이징 쿼리 -->
<select id="pagingList"
	resultType="org.studentcrm.crm.command.ConsultVO"
	parameterType="org.studentcrm.crm.command.Criteria">
	select * from 
		(select rownum as rnum, B.* from 
			(select * from consult order by num desc) B  
		where rownum &lt;= #{pageEnd}) 
	where #{pageStart} &lt;= rnum 
</select>

</mapper>